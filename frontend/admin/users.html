<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Ng∆∞·ªùi D√πng - Admin</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">üéì H·ªá Th·ªëng H·ªçc Tr·ª±c Tuy·∫øn AI - Admin</div>
            <ul class="navbar-menu">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="users.html">Ng∆∞·ªùi D√πng</a></li>
                <li><a href="courses.html">Kh√≥a H·ªçc</a></li>
                <li><a href="statistics.html">Th·ªëng K√™</a></li>
                <li><a href="#" onclick="logout()">ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h1 style="margin-bottom: 2rem;">Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h1>
        
        <div class="card">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>T√™n ƒêƒÉng Nh·∫≠p</th>
                        <th>H·ªç T√™n</th>
                        <th>Email</th>
                        <th>Vai Tr√≤</th>
                        <th>Tr·∫°ng Th√°i</th>
                        <th>Thao T√°c</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <tr>
                        <td colspan="7" style="text-align: center;">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        if (!isAuthenticated()) {
            redirectTo('../index.html');
        }
        
        async function loadUsers() {
            try {
                const users = await adminAPI.getUsers();
                renderUsers(users);
            } catch (error) {
                showAlert('L·ªói t·∫£i danh s√°ch ng∆∞·ªùi d√πng: ' + error.message, 'error');
            }
        }
        
        function renderUsers(users) {
            const tbody = document.getElementById('usersTable');
            
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o.</td></tr>';
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.user_id}</td>
                    <td>${user.username}</td>
                    <td>${user.full_name}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>${user.is_active ? '<span style="color: var(--success-color);">Ho·∫°t ƒë·ªông</span>' : '<span style="color: var(--danger-color);">Kh√≥a</span>'}</td>
                    <td>
                        ${user.is_active ? `
                            <button class="btn btn-warning" onclick="deactivateUser(${user.user_id})">Kh√≥a</button>
                        ` : `
                            <button class="btn btn-success" onclick="activateUser(${user.user_id})">K√≠ch Ho·∫°t</button>
                        `}
                        <button class="btn btn-danger" onclick="deleteUser(${user.user_id})">X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }
        
        async function deactivateUser(userId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën kh√≥a ng∆∞·ªùi d√πng n√†y?')) return;
            
            try {
                await adminAPI.deactivateUser(userId);
                showAlert('ƒê√£ kh√≥a ng∆∞·ªùi d√πng', 'success');
                loadUsers();
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function activateUser(userId) {
            try {
                await adminAPI.activateUser(userId);
                showAlert('ƒê√£ k√≠ch ho·∫°t ng∆∞·ªùi d√πng', 'success');
                loadUsers();
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        async function deleteUser(userId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) return;
            
            try {
                await adminAPI.deleteUser(userId);
                showAlert('ƒê√£ x√≥a ng∆∞·ªùi d√πng', 'success');
                loadUsers();
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        loadUsers();
    </script>
</body>
</html>

