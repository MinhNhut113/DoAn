<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Kh√≥a H·ªçc - Admin</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">üéì H·ªá Th·ªëng H·ªçc Tr·ª±c Tuy·∫øn AI - Admin</div>
            <ul class="navbar-menu">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="users.html">Ng∆∞·ªùi D√πng</a></li>
                <li><a href="courses.html">Kh√≥a H·ªçc</a></li>
                <li><a href="statistics.html">Th·ªëng K√™</a></li>
                <li><a href="#" onclick="logout()">ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1>Qu·∫£n L√Ω Kh√≥a H·ªçc</h1>
            <button class="btn btn-primary" onclick="showCreateModal()">Th√™m Kh√≥a H·ªçc</button>
        </div>
        
        <div class="grid" id="coursesGrid">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Modal -->
    <div id="courseModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
        <div class="card" style="max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div class="card-header" id="modalTitle">Th√™m Kh√≥a H·ªçc</div>
            <form id="courseForm">
                <div class="form-group">
                    <label for="course_name">T√™n Kh√≥a H·ªçc</label>
                    <input type="text" id="course_name" required>
                </div>
                <div class="form-group">
                    <label for="description">M√¥ T·∫£</label>
                    <textarea id="description" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="thumbnail_url">URL ·∫¢nh B√¨a</label>
                    <input type="url" id="thumbnail_url">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        let editingCourseId = null;
        
        if (!isAuthenticated()) {
            redirectTo('../index.html');
        }
        
        async function loadCourses() {
            try {
                const courses = await coursesAPI.getAll(false);
                renderCourses(courses);
            } catch (error) {
                showAlert('L·ªói t·∫£i kh√≥a h·ªçc: ' + error.message, 'error');
            }
        }
        
        function renderCourses(courses) {
            const grid = document.getElementById('coursesGrid');
            
            if (courses.length === 0) {
                grid.innerHTML = '<p>Ch∆∞a c√≥ kh√≥a h·ªçc n√†o.</p>';
                return;
            }
            
            grid.innerHTML = courses.map(course => `
                <div class="course-card">
                    ${course.thumbnail_url ? `<img src="${course.thumbnail_url}" alt="${course.course_name}">` : ''}
                    <div class="course-card-body">
                        <h3>${course.course_name}</h3>
                        <p>${course.description ? (course.description.substring(0, 100) + '...') : ''}</p>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="editCourse(${course.course_id})">S·ª≠a</button>
                            <button class="btn btn-danger" onclick="deleteCourse(${course.course_id})">X√≥a</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function showCreateModal() {
            editingCourseId = null;
            document.getElementById('modalTitle').textContent = 'Th√™m Kh√≥a H·ªçc';
            document.getElementById('courseForm').reset();
            document.getElementById('courseModal').classList.remove('hidden');
        }
        
        function hideModal() {
            document.getElementById('courseModal').classList.add('hidden');
        }
        
        async function editCourse(courseId) {
            try {
                const course = await coursesAPI.getById(courseId);
                editingCourseId = courseId;
                document.getElementById('modalTitle').textContent = 'S·ª≠a Kh√≥a H·ªçc';
                document.getElementById('course_name').value = course.course_name;
                document.getElementById('description').value = course.description || '';
                document.getElementById('thumbnail_url').value = course.thumbnail_url || '';
                document.getElementById('courseModal').classList.remove('hidden');
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        document.getElementById('courseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const courseData = {
                course_name: document.getElementById('course_name').value,
                description: document.getElementById('description').value,
                thumbnail_url: document.getElementById('thumbnail_url').value
            };
            
            try {
                if (editingCourseId) {
                    await adminAPI.updateCourse(editingCourseId, courseData);
                    showAlert('C·∫≠p nh·∫≠t th√†nh c√¥ng!', 'success');
                } else {
                    await adminAPI.createCourse(courseData);
                    showAlert('T·∫°o kh√≥a h·ªçc th√†nh c√¥ng!', 'success');
                }
                hideModal();
                loadCourses();
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        });
        
        async function deleteCourse(courseId) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√≥a h·ªçc n√†y?')) return;
            
            try {
                await adminAPI.deleteCourse(courseId);
                showAlert('ƒê√£ x√≥a kh√≥a h·ªçc', 'success');
                loadCourses();
            } catch (error) {
                showAlert('L·ªói: ' + error.message, 'error');
            }
        }
        
        loadCourses();
    </script>
</body>
</html>

