<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh√≥a H·ªçc - Sinh Vi√™n</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">üéì H·ªá Th·ªëng H·ªçc Tr·ª±c Tuy·∫øn AI</div>
            <ul class="navbar-menu">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="courses.html">Kh√≥a H·ªçc</a></li>
                <li><a href="progress.html">Ti·∫øn ƒê·ªô</a></li>
                <li><a href="profile.html">H·ªì S∆°</a></li>
                <li><a href="#" onclick="logout()">ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1>Kh√≥a H·ªçc</h1>
            <div>
                <button class="btn btn-secondary" onclick="toggleView()" id="toggleBtn">Xem T·∫•t C·∫£</button>
            </div>
        </div>
        
        <div class="grid" id="coursesGrid">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script>
        let showingEnrolledOnly = true;
        
        if (!isAuthenticated()) {
            redirectTo('../index.html');
        }
        
        async function loadCourses(enrolledOnly = true) {
            try {
                const courses = await coursesAPI.getAll(enrolledOnly);
                renderCourses(courses);
            } catch (error) {
                showAlert('L·ªói t·∫£i kh√≥a h·ªçc: ' + error.message, 'error');
            }
        }
        
        function renderCourses(courses) {
            const grid = document.getElementById('coursesGrid');
            
            if (courses.length === 0) {
                grid.innerHTML = '<p>Kh√¥ng c√≥ kh√≥a h·ªçc n√†o.</p>';
                return;
            }
            
            grid.innerHTML = courses.map(course => `
                <div class="course-card">
                    ${course.thumbnail_url ? `<img src="${course.thumbnail_url}" alt="${course.course_name}">` : ''}
                    <div class="course-card-body">
                        <h3>${course.course_name}</h3>
                        <p>${course.description ? (course.description.substring(0, 100) + '...') : ''}</p>
                        ${course.is_enrolled ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${course.progress_percentage || 0}%"></div>
                            </div>
                            <p style="text-align: center; margin-top: 0.5rem;">${(course.progress_percentage || 0).toFixed(1)}%</p>
                            <a href="course-detail.html?id=${course.course_id}" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Ti·∫øp T·ª•c H·ªçc</a>
                        ` : `
                            <button class="btn btn-success" style="width: 100%; margin-top: 1rem;" onclick="enrollCourse(${course.course_id})">ƒêƒÉng K√Ω</button>
                        `}
                    </div>
                </div>
            `).join('');
        }
        
        async function enrollCourse(courseId) {
            try {
                await coursesAPI.enroll(courseId);
                showAlert('ƒêƒÉng k√Ω kh√≥a h·ªçc th√†nh c√¥ng!', 'success');
                loadCourses(showingEnrolledOnly);
            } catch (error) {
                showAlert('L·ªói ƒëƒÉng k√Ω: ' + error.message, 'error');
            }
        }
        
        function toggleView() {
            showingEnrolledOnly = !showingEnrolledOnly;
            document.getElementById('toggleBtn').textContent = showingEnrolledOnly ? 'Xem T·∫•t C·∫£' : 'Ch·ªâ Xem ƒê√£ ƒêƒÉng K√Ω';
            loadCourses(showingEnrolledOnly);
        }
        
        loadCourses(showingEnrolledOnly);
    </script>
</body>
</html>

